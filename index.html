<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Finatics Aquatics - African Cichlid Breeders" />
  <title>Finatics Aquatics</title>
  <link rel="stylesheet" href="css/style.css" />
  <script defer>
    const sheetUrl = 'https://script.google.com/macros/s/AKfycby7R9zrOBS-pg0AwxU_yRaKLo6VUWM8oPjLFkZhiJyl2SkTVw98ENSsO3iC3ISHYqSd/exec';
    let stockData = {};
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    async function fetchStock() {
      try {
        const res = await fetch(sheetUrl);
        stockData = await res.json();
        console.log("Fetched stock data:", stockData);

        const grid = document.getElementById('fish-grid');
        grid.innerHTML = '';

        for (const fish in stockData) {
          const items = stockData[fish];
          const card = document.createElement('div');
          card.className = 'fish-card';

          const img = document.createElement('img');
          const baseName = fish.toLowerCase().replace(/\s+/g, '-');
          img.src = `images/${baseName}.jpg`;
          img.alt = fish;
          img.onerror = () => {
            img.onerror = null;
            img.src = `images/${baseName}.png`;
            img.onerror = () => {
              img.src = 'images/fallback.png';
            };
          };
          card.appendChild(img);

          const title = document.createElement('h3');
          title.textContent = fish;
          card.appendChild(title);

          const selector = document.createElement('div');
          selector.className = 'selector';

          const sizeSelect = document.createElement('select');
          sizeSelect.style.width = '200px';
          sizeSelect.innerHTML = '<option value="">Choose a size</option>';
          items.forEach(entry => {
            const opt = document.createElement('option');
            opt.value = JSON.stringify(entry);
            opt.textContent = `${entry.size} — £${entry.price} — Stock: ${entry.stock}`;
            sizeSelect.appendChild(opt);
          });

          const qtyInput = document.createElement('input');
          qtyInput.type = 'number';
          qtyInput.min = '1';
          qtyInput.value = '1';
          qtyInput.placeholder = 'Qty';

          const addBtn = document.createElement('button');
          addBtn.textContent = 'Add to Cart';
          addBtn.addEventListener('click', () => {
            const selected = sizeSelect.value;
            const quantity = parseInt(qtyInput.value);
            if (!selected || isNaN(quantity) || quantity < 1) {
              alert('Please select a size and quantity.');
              return;
            }

            const { size, price } = JSON.parse(selected);
            cart.push({ fish, size, quantity, price });
            renderCart();
          });

          selector.appendChild(sizeSelect);
          selector.appendChild(qtyInput);
          selector.appendChild(addBtn);
          card.appendChild(selector);
          grid.appendChild(card);
        }

        renderCart();
      } catch (error) {
        console.error('Error loading stock data:', error);
      }
    }

    function renderCart() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      cartItems.innerHTML = '';
      let totalAmount = 0;
      cart.forEach((item, index) => {
        const subtotal = item.quantity * item.price;
        const li = document.createElement('li');
        li.innerHTML = `${item.quantity} x ${item.fish} (${item.size}) — £${subtotal} <button data-index="${index}" class="remove-btn" style="margin-left: 10px; background-color: #e63946; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">Remove</button>`;
        cartItems.appendChild(li);
        totalAmount += subtotal;
      });
      cartTotal.textContent = totalAmount > 0 ? `Total: £${totalAmount}` : '';
      localStorage.setItem('cart', JSON.stringify(cart));

      document.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.getAttribute('data-index'));
          cart.splice(index, 1);
          renderCart();
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchStock();

      document.getElementById('clear-cart').addEventListener('click', () => {
        cart.length = 0;
        localStorage.removeItem('cart');
        document.getElementById('cart-items').innerHTML = '';
        document.getElementById('cart-total').textContent = '';
      });

      document.getElementById('checkout-cart').addEventListener('click', () => {
        if (cart.length === 0) {
          alert('Your cart is empty.');
          return;
        }

        const formData = new FormData();
        formData.append('name', document.getElementById('customer-name').value);
        formData.append('email', document.getElementById('customer-email').value);
        formData.append('_replyto', document.getElementById('customer-email').value);
        formData.append('_cc', 'atbetteridge@hotmail.co.uk');
        formData.append('_subject', `New Order from ${document.getElementById('customer-name').value}`);
        formData.append('message', `Thank you ${document.getElementById('customer-name').value}, your order has been submitted.`);

        let totalAmount = 0;
        const orderSummary = cart.map(item => {
          const subtotal = item.quantity * item.price;
          totalAmount += subtotal;
          return `${item.quantity} x ${item.fish} (${item.size}) — £${subtotal}`;
        }).join('\n');
        const fullSummary = `${orderSummary}\n\nTotal: £${totalAmount}`;

        formData.append('order', fullSummary);

        fetch('https://formspree.io/f/mwpobwwy', {
          method: 'POST',
          body: formData,
        })
          .then(response => {
            if (response.ok) {
              window.location.href = 'thank-you.html';
              return;
            } else {
              alert('Failed to submit order.');
            }
          })
          .catch(error => {
            console.error('Error submitting order:', error);
            alert('There was an error. Please try again later.');
          });
      });
    });
  </script>
</head>
<body>
  <header class="hero">
    <img src="images/FinaticsCoveringPhoto.png" alt="Finatics Aquatics Banner" class="hero-image" />
    <div class="hero-overlay">
      <img src="images/FinaticsAquaticsLogoV2.png" alt="Finatics Aquatics Logo" class="hero-logo" />
      <h1 class="hero-title">Bred With Passion. <br />Raised With Care.</h1>
    </div>
  </header>

  <nav>
    <ul>
      <li><a href="#available">Available Fish</a></li>
      <li><a href="#setup">Our Setup</a></li>
      <li><a href="#about">About Us</a></li>
      <li><a href="#contact">Contact</a></li>
    </ul>
  </nav>

  <main>
    <section id="available">
      <h2>Available Fish</h2>
      <div class="fish-grid" id="fish-grid"></div>
    </section>

    <section id="cart">
      <h3>Cart</h3>
      <label for="customer-name">Name</label>
      <input type="text" id="customer-name" name="name" placeholder="Your name" required>
      <label for="customer-email">Email</label>
      <input type="email" id="customer-email" name="email" placeholder="Your email" required>
      <ul id="cart-items"></ul>
      <p id="cart-total"></p>
      <button id="clear-cart">Clear Cart</button>
      <button id="checkout-cart">Submit Order</button>
    </section>

    <section id="setup">
      <h2>Our Breeding Setup</h2>
      <p>We use a modular tank system with clean water cycling and natural filtration through aquaponics. Each breeding pair is given a dedicated tank to ensure quality offspring and optimal health.</p>
    </section>

    <section id="about">
      <h2>About Us</h2>
      <p>We are a family-run breeder in the UK, passionate about African cichlids. Our goal is to produce vibrant, healthy fish raised in a loving environment. From tank care to feeding routines, we involve our children in every part of the process.</p>
    </section>

    <section id="contact">
      <h2>Contact Us</h2>
      <p>Email: <a href="mailto:info@finaticsaquatics.com">info@finaticsaquatics.com</a></p>
      <p>WhatsApp: 07XXX XXXXXX</p>
      <p>Follow us on Facebook and Instagram</p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Finatics Aquatics. All rights reserved.</p>
    <p><a href="https://finatic-andrewbetteridge.github.io/FinaticsAquatics.github.io-/">Visit our live site</a></p>
  </footer>
</body>
</html>
